"use strict";(self.webpackChunkjellyfish_docs=self.webpackChunkjellyfish_docs||[]).push([[7449],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>h});var n=r(7294);function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){o(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,n,o=function(e,t){if(null==e)return{};var r,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)r=i[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}var l=n.createContext({}),c=function(e){var t=n.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},u=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},m="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var r=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(r),d=o,h=m["".concat(l,".").concat(d)]||m[d]||p[d]||i;return r?n.createElement(h,a(a({ref:t},u),{},{components:r})):n.createElement(h,a({ref:t},u))}));function h(e,t){var r=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=r.length,a=new Array(i);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:o,a[1]=s;for(var c=2;c<i;c++)a[c]=r[c];return n.createElement.apply(null,a)}return n.createElement.apply(null,r)}d.displayName="MDXCreateElement"},6027:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});var n=r(7462),o=(r(7294),r(3905));const i={},a="Metrics Design",s={unversionedId:"for_developers/metrics_design",id:"for_developers/metrics_design",title:"Metrics Design",description:"Currently, jellyfish exposed a few metrics, which included a label room_id.",source:"@site/docs/for_developers/metrics_design.md",sourceDirName:"for_developers",slug:"/for_developers/metrics_design",permalink:"/jellyfish-docs/next/for_developers/metrics_design",draft:!1,editUrl:"https://github.com/jellyfish-dev/jellyfish-docs/docs/for_developers/metrics_design.md",tags:[],version:"current",frontMatter:{},sidebar:"mainSidebar",previous:{title:"Design Docs",permalink:"/jellyfish-docs/next/for_developers/design_docs"},next:{title:"API Reference",permalink:"/jellyfish-docs/next/for_developers/api_reference"}},l={},c=[{value:"Additional Resources:",id:"additional-resources",level:4}],u={toc:c},m="wrapper";function p(e){let{components:t,...r}=e;return(0,o.kt)(m,(0,n.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"metrics-design"},"Metrics Design"),(0,o.kt)("p",null,"Currently, jellyfish exposed a few metrics, which included a label room_id.\nSome could be worried about the cardinality of this type of metric.\nTo answer these worries, we have to deepen our knowledge about Prometheus metrics.\nEach unique labelset creates a separate time series.\nEach additional time series has RAM, CPU, disk, and network costs.\nThis cost is usually negligible, but when we talk about hundreds of servers and metrics, it can add up quickly.\nBut the question is, how quickly will this add up? "),(0,o.kt)("p",null,"At the moment (16.11.2023), Prometheus can handle around ten million time series.\nPrometheus maintainers suggest that when analyzing the capacity of Prometheus, we should think about a cluster where one Prometheus instance monitors around 1000 servers.\nDefault retention in Prometheus is 15 days, meaning time series older than 15 days are removed.\nBased on this assumption, we can approximate how many rooms per hour on each of 1000 jellyfish for 15 days straight must be created to reach Prometheus limits."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"room_per_hour_on_jellyfish =\n= total_time_series_limit / number_of_jellyfishes / prometheus_retention_in_days / hours_in_day = \n= 10_000_000 / 1_000 / 15 / 24 = 27\n")),(0,o.kt)("p",null,"This limit is pretty high and, in most use cases, shouldn't be a problem.\nBut to be cautious, we will add this label only to metrics where that is required, and we will try to minimize the amount of metrics where that is used."),(0,o.kt)("p",null,"If this label is a problem for you, there are a few solutions:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"We are thinking about adding a possibility to configurable disable metrics that use the label ",(0,o.kt)("inlineCode",{parentName:"li"},"room_id"),", but it is not in our current roadmap"),(0,o.kt)("li",{parentName:"ul"},"You can define in Prometheus that at the scrape time, some labels will be dropped from metrics. (Remember that label dropping should be done cautiously as it could lead to the dropping of some data or aggregation)."),(0,o.kt)("li",{parentName:"ul"},"Similarly to previous in Prometheus, at the scrape time, you can define to drop some specific metric.")),(0,o.kt)("p",null,"To get more information about relabeling, metrics or label dropping we suggest to read ",(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/docs/grafana-cloud/cost-management-and-billing/reduce-costs/metrics-costs/client-side-filtering/"},"grafana tutorial"),"."),(0,o.kt)("h4",{id:"additional-resources"},"Additional Resources:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://prometheus.io/docs/practices/instrumentation/#use-labels"},"https://prometheus.io/docs/practices/instrumentation/#use-labels")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://stackoverflow.com/a/69167162"},"https://stackoverflow.com/a/69167162")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://newrelic.com/blog/how-to-relic/manage-prometheus-cardinality"},"https://newrelic.com/blog/how-to-relic/manage-prometheus-cardinality")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://grafana.com/blog/2022/10/20/how-to-manage-high-cardinality-metrics-in-prometheus-and-kubernetes/"},"https://grafana.com/blog/2022/10/20/how-to-manage-high-cardinality-metrics-in-prometheus-and-kubernetes/")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://grafana.com/blog/2022/03/21/how-relabeling-in-prometheus-works/"},"https://grafana.com/blog/2022/03/21/how-relabeling-in-prometheus-works/"))))}p.isMDXComponent=!0}}]);