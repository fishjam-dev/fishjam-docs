"use strict";(self.webpackChunkjellyfish_docs=self.webpackChunkjellyfish_docs||[]).push([[705],{1602:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>g,frontMatter:()=>o,metadata:()=>r,toc:()=>p});var a=n(7462),i=(n(7294),n(3905));const o={},s="Signaling architecture",r={unversionedId:"signaling_architecture",id:"signaling_architecture",title:"Signaling architecture",description:"Glossary:",source:"@site/docs/signaling_architecture.md",sourceDirName:".",slug:"/signaling_architecture",permalink:"/docs/signaling_architecture",draft:!1,editUrl:"https://github.com/jellyfish-dev/jellyfish-docs/docs/signaling_architecture.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar"},l={},p=[{value:"Approaches",id:"approaches",level:2},{value:"Direct connection",id:"direct-connection",level:3},{value:"Using <strong>BE</strong> as a middleman",id:"using-be-as-a-middleman",level:3},{value:"Mixed approach",id:"mixed-approach",level:3},{value:"Conclusion",id:"conclusion",level:2}],m={toc:p},c="wrapper";function g(e){let{components:t,...n}=e;return(0,i.kt)(c,(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"signaling-architecture"},"Signaling architecture"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Glossary:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"CL")," - client"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"BE")," - business logic (backend) implemented by the user"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"JF")," - Jellyfish")),(0,i.kt)("h2",{id:"approaches"},"Approaches"),(0,i.kt)("p",null,"Currently we consider three approaches to the signaling implementation:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"direct connection between ",(0,i.kt)("strong",{parentName:"li"},"CL")," and ",(0,i.kt)("strong",{parentName:"li"},"JF")," bypassing ",(0,i.kt)("strong",{parentName:"li"},"BE"),","),(0,i.kt)("li",{parentName:"ul"},"using ",(0,i.kt)("strong",{parentName:"li"},"BE")," as a middleman to pass signaling messages,"),(0,i.kt)("li",{parentName:"ul"},"ability to use either of the options above, but providing some default implementation (i.e provide default implementation of direct signaling, but\nlet the user replace it with his own implementation).")),(0,i.kt)("h3",{id:"direct-connection"},"Direct connection"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"CL")," must be able to open connection to ",(0,i.kt)("strong",{parentName:"p"},"JF")," (e.g. WebSocket). For that ",(0,i.kt)("strong",{parentName:"p"},"CL")," requires ",(0,i.kt)("strong",{parentName:"p"},"JF")," address and some form of authentication."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example:")),(0,i.kt)("p",null,"1) ",(0,i.kt)("strong",{parentName:"p"},"CL")," sends request to ",(0,i.kt)("strong",{parentName:"p"},"BE")," to join some room (meeting, webinar etc.).\n2) ",(0,i.kt)("strong",{parentName:"p"},"BE")," sends request to ",(0,i.kt)("strong",{parentName:"p"},"JF")," (",(0,i.kt)("em",{parentName:"p"},"add_peer"),").\n3) ",(0,i.kt)("strong",{parentName:"p"},"JF")," responds positively.\n4) ",(0,i.kt)("strong",{parentName:"p"},"BE")," responds to client positively with generated token.\n5) ",(0,i.kt)("strong",{parentName:"p"},"CL")," opens WebSocket connection to ",(0,i.kt)("strong",{parentName:"p"},"JF"),", flow of signaling messages begins."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"JF")," can diferentiate between the clients by the opened WebSocket connection. It knows\nwho is the sender of incoming Media Events and where to send generated Media Events."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Advantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Easier option, the user doesn't have to do much more than passing authentication token to ",(0,i.kt)("strong",{parentName:"li"},"CL"),", client SDK handles the rest."),(0,i.kt)("li",{parentName:"ul"},"Both ",(0,i.kt)("strong",{parentName:"li"},"CL")," and ",(0,i.kt)("strong",{parentName:"li"},"JF")," can tell when signaling connection was broken. That prevents situation when signaling connection between ",(0,i.kt)("strong",{parentName:"li"},"CL")," and ",(0,i.kt)("strong",{parentName:"li"},"BE")," was broken, but ",(0,i.kt)("strong",{parentName:"li"},"BE"),"\ndid not notify ",(0,i.kt)("strong",{parentName:"li"},"JF")," of such occurence, is that case media is still flowing with no signaling (when new peer joins, tracks are not renegotiated, etc.).")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Disadvantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"CL")," has to participate in the authentication process (so they probably need to be\nauthenticated by ",(0,i.kt)("strong",{parentName:"li"},"BE")," and then authenticated again to open connection to ",(0,i.kt)("strong",{parentName:"li"},"JF"),")."),(0,i.kt)("li",{parentName:"ul"},"Some events can get desynchronized. Imagine scenerio where ",(0,i.kt)("strong",{parentName:"li"},"JF")," sent notification to\n",(0,i.kt)("strong",{parentName:"li"},"BE")," that recording has begun (it is ",(0,i.kt)("strong",{parentName:"li"},"BE"),"'s responibility\nto propagate this information to clients so they can show some icon indicator). At\nthe same time, media and signaling connections were broken for some reason.\nFor a brief moment (until ",(0,i.kt)("strong",{parentName:"li"},"JF")," passes that information to ",(0,i.kt)("strong",{parentName:"li"},"BE")," and ",(0,i.kt)("strong",{parentName:"li"},"BE")," passes\nit to ",(0,i.kt)("strong",{parentName:"li"},"CL"),") ",(0,i.kt)("strong",{parentName:"li"},"CL")," might think that their screen is being recorded\neven though that is not the case (situation in this example can be prevented, but I hope\nyou get the gist).")),(0,i.kt)("h3",{id:"using-be-as-a-middleman"},"Using ",(0,i.kt)("strong",{parentName:"h3"},"BE")," as a middleman"),(0,i.kt)("p",null,"Client SDK generates signaling messages, but requires the user to implement logic that handles forwarding them to ",(0,i.kt)("strong",{parentName:"p"},"JF")," (using ",(0,i.kt)("strong",{parentName:"p"},"BE")," in described scenario)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Exmaple:")),(0,i.kt)("p",null,"1) ",(0,i.kt)("strong",{parentName:"p"},"CL")," sends request to ",(0,i.kt)("strong",{parentName:"p"},"BE")," to join some room (meeting, webinar etc.).\n2) ",(0,i.kt)("strong",{parentName:"p"},"BE")," sends request to ",(0,i.kt)("strong",{parentName:"p"},"JF")," (",(0,i.kt)("em",{parentName:"p"},"add_peer"),").\n3) ",(0,i.kt)("strong",{parentName:"p"},"JF")," responds positively.\n4) ",(0,i.kt)("strong",{parentName:"p"},"BE")," responds to client positively.\n5) ",(0,i.kt)("strong",{parentName:"p"},"CL")," starts generating signaling messages which are forwarded to ",(0,i.kt)("strong",{parentName:"p"},"JF")," by ",(0,i.kt)("strong",{parentName:"p"},"BE"),"."),(0,i.kt)("p",null,"In that case we need a way to identify the sender of signaling messages, we thought of 2 approaches (you'r welcome to suggest a better one):"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"make ",(0,i.kt)("strong",{parentName:"li"},"BE")," open WebSocket connection to ",(0,i.kt)("strong",{parentName:"li"},"JF")," for every client (here seems like a very bad idea, makes a bit more sense in the mixed approach described later),"),(0,i.kt)("li",{parentName:"ul"},"tag every signaling message with something like ",(0,i.kt)("inlineCode",{parentName:"li"},"peer_id"),", requires only one WebSocket connection between ",(0,i.kt)("strong",{parentName:"li"},"BE")," and ",(0,i.kt)("strong",{parentName:"li"},"JF")," (should SDK do this, or should it be the users responsibility?).")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Advantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Easy to implement (from our, Jellyfish developers, perspective)."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"CL")," does not require additional connection and authentication, everything is handled by ",(0,i.kt)("strong",{parentName:"li"},"BE"),".")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Disadvantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Harder to implement by the user, much more error-prone (isn't that the point of Jellyfish to make it as simple as possible?)."),(0,i.kt)("li",{parentName:"ul"},'Encourages the user to implement logic that relies on content of signaling messages (at least while it\'s JSON) which they should treat as a "black box".')),(0,i.kt)("h3",{id:"mixed-approach"},"Mixed approach"),(0,i.kt)("p",null,"By default, direct connection approach is used, but the user can swap the implementation to his own.\nWe assume that only one approach is being used at once (there cannot be a situation when some peers are using direct signaling, and some signaling messages forwarded by ",(0,i.kt)("strong",{parentName:"p"},"BE")," at the same time), but that's a whole another thing to consider."),(0,i.kt)("p",null,"Now the problem with identifying signaling messages becomes much more apparent."),(0,i.kt)("p",null,"If signaling messages are individually tagged, when using direct connection approach there's some redundancy (",(0,i.kt)("strong",{parentName:"p"},"JF"),' doesn\'t need the "tag", it can tell who\nis who by the WebSocket connection),\nbut the tags are necessary when using ',(0,i.kt)("strong",{parentName:"p"},"BE")," as a middleman. Obviously, we can handle each situation differently and not tag messages passed in\ndirect connection, but that makes the implementation much more complicated."),(0,i.kt)("p",null,"On the other hand, when tags are not used, there's everything alright with direct connection, but again, situation with ",(0,i.kt)("strong",{parentName:"p"},"BE")," used as a middleman has to be handled differently\n(which makes it complicated) or ",(0,i.kt)("strong",{parentName:"p"},"BE")," has to open WebSocket connection for every client (consistent but meh)."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Advantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"More flexible."),(0,i.kt)("li",{parentName:"ul"},"The best of both worlds.")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Disadvantages:")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"More complicated to implement."),(0,i.kt)("li",{parentName:"ul"},"Introduces some redundancy (at least the ways to identify signaling messages that we thought of).")),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"The approach that we are going to use is the ",(0,i.kt)("strong",{parentName:"p"},"direct connection"),", mostly because it's a lot easier for the user to implement (which outweights benefits like the flexibility of the other approach).\nAlso, the drawbacks seem not to be very severe: some of the information about the state of rooms and peers (like the fact that recording has begun) can be\nkept and shared by ",(0,i.kt)("strong",{parentName:"p"},"JF")," via the signalling connection.\nMixed approach is not considered at the moment (as it brings some difficulties) but can be added in the future if there's need."))}g.isMDXComponent=!0}}]);